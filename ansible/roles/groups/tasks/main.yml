---
# Grab the existing users and groups
- name: Grab the existing users
  ansible.builtin.getent:
    database: passwd
    fail_key: false
- name: Grab the existing groups
  ansible.builtin.getent:
    database: group
    fail_key: false


#
# Add the cyhy user to the docker group, if they both exist
#
- name: Add the cyhy user to the docker group
  ansible.builtin.user:
    append: true
    groups: docker
    name: cyhy
  when: (getent_passwd.cyhy is defined) and (getent_group.docker is defined)


#
# Add dev known users to the cyhy and docker groups, if they exist
#
- name: Add dev users to the cyhy group
  ansible.builtin.user:
    append: true
    groups: cyhy
    name: "{{ item }}"
  loop: "{{ groups_dev_users }}"
  when: getent_group.cyhy is defined

- name: Add dev users to the docker group
  ansible.builtin.user:
    append: true
    groups: docker
    name: "{{ item }}"
  loop: "{{ groups_dev_users }}"
  when: getent_group.docker is defined
